# å‰ç«¯å·¥ç¨‹åŒ–

## æ¦‚è¿°

å‰ç«¯å·¥ç¨‹åŒ–æ˜¯å°†å‰ç«¯å¼€å‘æµç¨‹è§„èŒƒåŒ–ã€è‡ªåŠ¨åŒ–çš„è¿‡ç¨‹,åŒ…æ‹¬**æ„å»ºå·¥å…·**ã€**ä»£ç è§„èŒƒ**ã€**è‡ªåŠ¨åŒ–æµ‹è¯•**ã€**CI/CD**ç­‰ã€‚

## æ ¸å¿ƒå†…å®¹

- ğŸ“¦ **æ„å»ºå·¥å…·** - Webpackã€Viteã€Rollup
- ğŸ”§ **ç¼–è¯‘å·¥å…·** - Babelã€TypeScriptã€SWC
- ğŸ“ **ä»£ç è§„èŒƒ** - ESLintã€Prettierã€Stylelint
- ğŸ§ª **è‡ªåŠ¨åŒ–æµ‹è¯•** - Jestã€Vitestã€Playwright
- ğŸš€ **CI/CD** - GitHub Actionsã€GitLab CI
- ğŸ“š **Monorepo** - pnpmã€Turborepoã€Nx

## ä¸ºä»€ä¹ˆéœ€è¦å·¥ç¨‹åŒ–?

```javascript
// æ²¡æœ‰å·¥ç¨‹åŒ–çš„é—®é¢˜:
/*
1. æ‰‹åŠ¨å‹ç¼©ä»£ç 
2. æ‰‹åŠ¨å¤„ç†å…¼å®¹æ€§
3. æ‰‹åŠ¨åˆå¹¶æ–‡ä»¶
4. æ²¡æœ‰ç»Ÿä¸€çš„ä»£ç è§„èŒƒ
5. æµ‹è¯•ä¾èµ–äººå·¥
6. éƒ¨ç½²æµç¨‹å¤æ‚æ˜“é”™
*/

// å·¥ç¨‹åŒ–è§£å†³:
/*
1. è‡ªåŠ¨æ„å»ºæ‰“åŒ…
2. è‡ªåŠ¨å¤„ç†å…¼å®¹æ€§(Babel)
3. è‡ªåŠ¨ä¼˜åŒ–ä»£ç 
4. å¼ºåˆ¶ä»£ç è§„èŒƒ(ESLint)
5. è‡ªåŠ¨åŒ–æµ‹è¯•
6. è‡ªåŠ¨åŒ–éƒ¨ç½²(CI/CD)
*/
```

## åŒ…ç®¡ç†å™¨å¯¹æ¯”ï¼šnpm vs yarn vs pnpm

### å‘å±•å†å²

- **npm**ï¼ˆ2010å¹´ï¼‰ï¼šNode.js çš„é»˜è®¤åŒ…ç®¡ç†å™¨ï¼Œæœ€æ—©ä¹Ÿæ˜¯ä½¿ç”¨æœ€å¹¿æ³›çš„
- **yarn**ï¼ˆ2016å¹´ï¼‰ï¼šFacebook è”åˆ Googleã€Exponent å¼€å‘ï¼Œè§£å†³ npm æ—©æœŸçš„æ€§èƒ½å’Œä¸€è‡´æ€§é—®é¢˜
- **pnpm**ï¼ˆ2017å¹´ï¼‰ï¼šperformant npmï¼Œé€šè¿‡åˆ›æ–°çš„å­˜å‚¨æœºåˆ¶æä¾›æ›´å¥½çš„æ€§èƒ½å’Œç£ç›˜æ•ˆç‡

### æ ¸å¿ƒåŒºåˆ«å¯¹æ¯”è¡¨

| ç‰¹æ€§ | npm | yarn | pnpm |
|------|-----|------|------|
| **å®‰è£…é€Ÿåº¦** | ä¸­ç­‰ | å¿«ï¼ˆå¹¶è¡Œå®‰è£…ï¼‰ | æœ€å¿«ï¼ˆç¡¬é“¾æ¥ï¼‰ |
| **ç£ç›˜å ç”¨** | å¤§ï¼ˆé‡å¤å®‰è£…ï¼‰ | å¤§ï¼ˆé‡å¤å®‰è£…ï¼‰ | å°ï¼ˆå…¨å±€å­˜å‚¨ï¼‰ |
| **ä¾èµ–ç®¡ç†æ–¹å¼** | æ‰å¹³åŒ– node_modules | æ‰å¹³åŒ– node_modules | ç¡¬é“¾æ¥ + è½¯é“¾æ¥ |
| **lockæ–‡ä»¶** | package-lock.json | yarn.lock | pnpm-lock.yaml |
| **å¹½çµä¾èµ–é—®é¢˜** | å­˜åœ¨ | å­˜åœ¨ | ä¸å­˜åœ¨ï¼ˆä¸¥æ ¼éš”ç¦»ï¼‰ |
| **Monorepoæ”¯æŒ** | workspacesï¼ˆv7+ï¼‰ | workspaces | åŸç”Ÿæ”¯æŒï¼Œæ€§èƒ½æœ€å¥½ |
| **NodeLinker** | hoisted | hoisted | isolatedï¼ˆå¯é…ç½®ï¼‰ |
| **å…¼å®¹æ€§** | æœ€å¥½ | å¥½ | éœ€è¦æ³¨æ„æŸäº›åœºæ™¯ |

### npm çš„é—®é¢˜

#### 1. åµŒå¥—åœ°ç‹±ï¼ˆnpm v2 æ—¶ä»£ï¼‰

```bash
# npm v2 çš„ node_modules ç»“æ„
node_modules/
â”œâ”€â”€ A
â”‚   â””â”€â”€ node_modules
â”‚       â””â”€â”€ B@1.0
â”‚           â””â”€â”€ node_modules
â”‚               â””â”€â”€ C@1.0
â””â”€â”€ D
    â””â”€â”€ node_modules
        â””â”€â”€ B@2.0
            â””â”€â”€ node_modules
                â””â”€â”€ C@2.0

# é—®é¢˜ï¼š
# - è·¯å¾„è¿‡é•¿ï¼ˆWindows é™åˆ¶ï¼‰
# - é‡å¤å®‰è£…ï¼ˆB å’Œ C éƒ½è£…äº†å¤šæ¬¡ï¼‰
# - å®‰è£…é€Ÿåº¦æ…¢
```

#### 2. å¹½çµä¾èµ–ï¼ˆPhantom Dependenciesï¼‰

```javascript
// package.json ä¸­åªå£°æ˜äº† A
{
  "dependencies": {
    "A": "^1.0.0"
  }
}

// ä½†å› ä¸º A ä¾èµ– Bï¼Œnpm v3+ æ‰å¹³åŒ–å
// ä½ çš„ä»£ç å¯ä»¥ç›´æ¥å¼•ç”¨ Bï¼ˆæœªå£°æ˜çš„ä¾èµ–ï¼‰
import B from 'B'; // èƒ½ç”¨ï¼Œä½†å¾ˆå±é™©ï¼

// é—®é¢˜ï¼š
// 1. A å‡çº§åå¯èƒ½ç§»é™¤ Bï¼Œå¯¼è‡´ä½ çš„ä»£ç å´©æºƒ
// 2. ä¸åŒç¯å¢ƒ node_modules ç»“æ„å¯èƒ½ä¸åŒ
// 3. ä¾èµ–å…³ç³»ä¸é€æ˜
```

#### 3. é‡å¤å®‰è£…é—®é¢˜

```bash
# å³ä½¿æ˜¯æ‰å¹³åŒ–ï¼Œä»å¯èƒ½é‡å¤å®‰è£…
node_modules/
â”œâ”€â”€ A (ä¾èµ– C@1.0)
â”œâ”€â”€ B (ä¾èµ– C@2.0)
â”œâ”€â”€ C@1.0  # è¢«æå‡
â””â”€â”€ B/
    â””â”€â”€ node_modules/
        â””â”€â”€ C@2.0  # é‡å¤å®‰è£…

# é—®é¢˜ï¼š
# - æµªè´¹ç£ç›˜ç©ºé—´
# - å®‰è£…æ—¶é—´é•¿
```

### pnpm ä¸ºä»€ä¹ˆæ›´å¿«æ›´çœç©ºé—´ï¼Ÿ

#### 1. ç¡¬é“¾æ¥å’Œè½¯é“¾æ¥æœºåˆ¶

```bash
# pnpm çš„ node_modules ç»“æ„
node_modules/
â”œâ”€â”€ .pnpm/
â”‚   â”œâ”€â”€ lodash@4.17.21/
â”‚   â”‚   â””â”€â”€ node_modules/
â”‚   â”‚       â””â”€â”€ lodash/          # çœŸå®æ–‡ä»¶ï¼ˆç¡¬é“¾æ¥åˆ°å…¨å±€å­˜å‚¨ï¼‰
â”‚   â””â”€â”€ axios@1.0.0/
â”‚       â””â”€â”€ node_modules/
â”‚           â”œâ”€â”€ axios/
â”‚           â””â”€â”€ follow-redirects/ # axios çš„ä¾èµ–
â”œâ”€â”€ lodash -> .pnpm/lodash@4.17.21/node_modules/lodash  # è½¯é“¾æ¥
â””â”€â”€ axios -> .pnpm/axios@1.0.0/node_modules/axios       # è½¯é“¾æ¥
```

**å…³é”®æ¦‚å¿µï¼š**
- **ç¡¬é“¾æ¥ï¼ˆHard Linkï¼‰**ï¼šæŒ‡å‘ç£ç›˜ä¸Šç›¸åŒçš„ inodeï¼Œå¤šä¸ªç¡¬é“¾æ¥å…±äº«åŒä¸€ä»½æ–‡ä»¶å†…å®¹
- **è½¯é“¾æ¥ï¼ˆSymbolic Linkï¼‰**ï¼šç±»ä¼¼å¿«æ·æ–¹å¼ï¼ŒæŒ‡å‘å¦ä¸€ä¸ªæ–‡ä»¶è·¯å¾„

```javascript
// ç¡¬é“¾æ¥ç¤ºæ„
// å…¨å±€å­˜å‚¨ï¼š~/.pnpm-store/v3/files/00/abc123...
// é¡¹ç›®Aï¼š   é¡¹ç›®/node_modules/.pnpm/lodash@4.17.21/...  â† ç¡¬é“¾æ¥
// é¡¹ç›®Bï¼š   é¡¹ç›®/node_modules/.pnpm/lodash@4.17.21/...  â† ç¡¬é“¾æ¥
// å®é™…åªå ç”¨ä¸€ä»½ç£ç›˜ç©ºé—´ï¼
```

#### 2. å†…å®¹å¯»å€å­˜å‚¨ï¼ˆContent-addressable Storeï¼‰

```bash
# pnpm å…¨å±€å­˜å‚¨ç»“æ„
~/.pnpm-store/
â””â”€â”€ v3/
    â””â”€â”€ files/
        â”œâ”€â”€ 00/
        â”‚   â””â”€â”€ a1b2c3...  # æ–‡ä»¶å†…å®¹çš„ hash
        â”œâ”€â”€ 01/
        â”‚   â””â”€â”€ d4e5f6...
        â””â”€â”€ ...

# ç‰¹ç‚¹ï¼š
# 1. ç›¸åŒæ–‡ä»¶åªå­˜ä¸€æ¬¡ï¼ˆåŸºäºå†…å®¹ hashï¼‰
# 2. æ‰€æœ‰é¡¹ç›®å…±äº«åŒä¸€ä¸ªå…¨å±€å­˜å‚¨
# 3. å®‰è£…æ—¶åªéœ€åˆ›å»ºç¡¬é“¾æ¥ï¼Œä¸éœ€è¦å¤åˆ¶æ–‡ä»¶
```

#### 3. ä¸¥æ ¼çš„ä¾èµ–éš”ç¦»

```javascript
// package.json
{
  "dependencies": {
    "express": "^4.18.0"
  }
}

// ä½¿ç”¨ npm/yarn
import lodash from 'lodash'; // èƒ½ç”¨ï¼express ä¾èµ–äº† lodash

// ä½¿ç”¨ pnpm
import lodash from 'lodash'; // æŠ¥é”™ï¼å¿…é¡»æ˜¾å¼å£°æ˜ä¾èµ–

// pnpm çš„ node_modules åªåŒ…å«ä½ å£°æ˜çš„ä¾èµ–
node_modules/
â”œâ”€â”€ express -> .pnpm/express@4.18.0/node_modules/express
â””â”€â”€ .pnpm/
    â”œâ”€â”€ express@4.18.0/
    â”‚   â””â”€â”€ node_modules/
    â”‚       â”œâ”€â”€ express/
    â”‚       â””â”€â”€ lodash/  # lodash åœ¨è¿™é‡Œï¼Œä½†ä½ è®¿é—®ä¸åˆ°
```

#### 4. æ€§èƒ½å¯¹æ¯”å®æµ‹

```bash
# å®‰è£… React é¡¹ç›®ä¾èµ–ï¼ˆ~1200ä¸ªåŒ…ï¼‰

# npm (v9)
time npm install
# è€—æ—¶: ~45s
# ç£ç›˜: ~200MB

# yarn (v1)
time yarn install
# è€—æ—¶: ~35s
# ç£ç›˜: ~200MB

# pnpm (v8)
time pnpm install
# è€—æ—¶: ~15sï¼ˆé¦–æ¬¡ï¼‰ã€~5sï¼ˆæœ‰ç¼“å­˜ï¼‰
# ç£ç›˜: ~50MBï¼ˆç¡¬é“¾æ¥ï¼‰

# ç»“è®ºï¼špnpm å¿« 2-3 å€ï¼Œçœç©ºé—´ 70%+
```

### å¸¸ç”¨å‘½ä»¤å¯¹æ¯”

```bash
# ============ å®‰è£…ä¾èµ– ============
npm install              # å®‰è£… package.json çš„æ‰€æœ‰ä¾èµ–
yarn                     # åŒä¸Šï¼ˆyarn install çš„ç®€å†™ï¼‰
pnpm install             # åŒä¸Š

# ============ æ·»åŠ ä¾èµ– ============
npm install lodash       # æ·»åŠ åˆ° dependencies
yarn add lodash          # åŒä¸Š
pnpm add lodash          # åŒä¸Š

npm install -D webpack   # æ·»åŠ åˆ° devDependencies
yarn add -D webpack      # åŒä¸Š
pnpm add -D webpack      # åŒä¸Š

npm install -g pm2       # å…¨å±€å®‰è£…
yarn global add pm2      # åŒä¸Š
pnpm add -g pm2          # åŒä¸Š

# ============ ç§»é™¤ä¾èµ– ============
npm uninstall lodash
yarn remove lodash
pnpm remove lodash

# ============ è¿è¡Œè„šæœ¬ ============
npm run dev
yarn dev                 # å¯ä»¥çœç•¥ run
pnpm dev                 # åŒä¸Š

# ============ æ›´æ–°ä¾èµ– ============
npm update
yarn upgrade
pnpm update

# ============ Monorepo ============
# åœ¨æ ¹ç›®å½•æ‰§è¡ŒæŸä¸ªåŒ…çš„è„šæœ¬
npm run build -w packageA
yarn workspace packageA build
pnpm -F packageA build   # -F æ˜¯ --filter çš„ç®€å†™

# ç»™ç‰¹å®šåŒ…æ·»åŠ ä¾èµ–
npm install lodash -w packageA
yarn workspace packageA add lodash
pnpm add lodash --filter packageA

# ============ pnpm ç‰¹æœ‰å‘½ä»¤ ============
pnpm store status        # æŸ¥çœ‹å…¨å±€å­˜å‚¨çŠ¶æ€
pnpm store prune         # æ¸…ç†æœªä½¿ç”¨çš„åŒ…
pnpm ls --depth 0        # æŸ¥çœ‹ç›´æ¥ä¾èµ–
pnpm why lodash          # ä¸ºä»€ä¹ˆå®‰è£…äº†è¿™ä¸ªåŒ…
```

### é…ç½®æ–‡ä»¶å¯¹æ¯”

```yaml
# .npmrc
registry=https://registry.npmjs.org/
save-exact=true
package-lock=true

# .yarnrc
registry "https://registry.npmjs.org/"
save-prefix ""

# .npmrc (pnpm ä¹Ÿç”¨è¿™ä¸ªæ–‡ä»¶)
registry=https://registry.npmjs.org/
shamefully-hoist=false    # ä¸æå‡ä¾èµ–ï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰
strict-peer-dependencies=false
```

### Monorepo æ”¯æŒå¯¹æ¯”

```json
// package.json - npm/yarn/pnpm é€šç”¨
{
  "name": "monorepo-root",
  "private": true,
  "workspaces": [
    "packages/*"
  ]
}
```

```yaml
# pnpm-workspace.yaml - pnpm ä¸“ç”¨
packages:
  - 'packages/*'
  - 'apps/*'
  - '!**/test/**'
```

```bash
# æ€§èƒ½å¯¹æ¯”ï¼ˆå¤§å‹ monorepoï¼Œ30ä¸ªåŒ…ï¼Œ5000+ä¾èµ–ï¼‰
npm workspaces install   # ~180s
yarn workspaces install  # ~120s
pnpm install            # ~25s ï¼ˆå¿«7å€ï¼ï¼‰

# pnpm çš„ä¼˜åŠ¿ï¼š
# 1. æ‰€æœ‰åŒ…å…±äº« .pnpm å­˜å‚¨ï¼Œæ²¡æœ‰é‡å¤
# 2. ç¡¬é“¾æ¥æœºåˆ¶ï¼Œå®‰è£…é€Ÿåº¦æå¿«
# 3. åŸç”Ÿæ”¯æŒ workspace åè®®
```

### å¦‚ä½•é€‰æ‹©ï¼Ÿ

#### é€‰æ‹© npm

```bash
# é€‚åˆåœºæ™¯ï¼š
âœ… å°å‹é¡¹ç›®ï¼Œä¾èµ–ä¸å¤š
âœ… éœ€è¦æœ€å¤§å…¼å®¹æ€§ï¼ˆæŸäº›è€æ—§å·¥å…·åªæ”¯æŒ npmï¼‰
âœ… å›¢é˜Ÿä¸æ„¿å¼•å…¥æ–°å·¥å…·
âœ… CI/CD ç¯å¢ƒé»˜è®¤ä½¿ç”¨ npm

# ä¼˜åŠ¿ï¼š
- Node.js è‡ªå¸¦ï¼Œæ— éœ€é¢å¤–å®‰è£…
- ç”Ÿæ€æœ€æˆç†Ÿï¼Œå…¼å®¹æ€§æœ€å¥½
- æ–‡æ¡£èµ„æºæœ€ä¸°å¯Œ
```

#### é€‰æ‹© yarn

```bash
# é€‚åˆåœºæ™¯ï¼š
âœ… è€é¡¹ç›®å·²ç»åœ¨ç”¨ yarn
âœ… éœ€è¦ yarn çš„ç‰¹å®šåŠŸèƒ½ï¼ˆå¦‚ yarn dlxï¼‰
âœ… Yarn 2+ (Berry) çš„ PnP æ¨¡å¼

# ä¼˜åŠ¿ï¼š
- æ¯” npm å¿«
- yarn.lock æ›´ç¨³å®š
- å‘½ä»¤æ›´ç®€æ´ï¼ˆyarn add vs npm installï¼‰

# æ³¨æ„ï¼š
- Yarn 1 (Classic) å·²åœæ­¢ç»´æŠ¤
- Yarn 2+ (Berry) æ”¹åŠ¨å¾ˆå¤§ï¼Œéœ€è¦å­¦ä¹ æˆæœ¬
```

#### é€‰æ‹© pnpmï¼ˆæ¨èï¼‰

```bash
# é€‚åˆåœºæ™¯ï¼š
âœ… æ–°é¡¹ç›®ï¼ˆå¼ºçƒˆæ¨èï¼‰
âœ… Monorepo é¡¹ç›®ï¼ˆæœ€ä½³é€‰æ‹©ï¼‰
âœ… ç£ç›˜ç©ºé—´æœ‰é™
âœ… éœ€è¦ä¸¥æ ¼çš„ä¾èµ–ç®¡ç†
âœ… è¿½æ±‚æè‡´æ€§èƒ½

# ä¼˜åŠ¿ï¼š
- æœ€å¿«çš„å®‰è£…é€Ÿåº¦
- æœ€å°çš„ç£ç›˜å ç”¨
- è§£å†³å¹½çµä¾èµ–é—®é¢˜
- Monorepo åŸç”Ÿæ”¯æŒä¸”æ€§èƒ½æœ€å¥½

# æ³¨æ„ï¼š
- æŸäº›è€æ—§å·¥å…·å¯èƒ½ä¸å…¼å®¹
- éœ€è¦å›¢é˜Ÿå­¦ä¹ æˆæœ¬ï¼ˆä½†å¾ˆä½ï¼‰
```

#### è¿ç§»åˆ° pnpm

```bash
# 1. å®‰è£… pnpm
npm install -g pnpm

# 2. åˆ é™¤æ—§çš„ä¾èµ–
rm -rf node_modules
rm package-lock.json  # æˆ– yarn.lock

# 3. ä½¿ç”¨ pnpm å®‰è£…
pnpm install

# 4. å¦‚æœé‡åˆ°å…¼å®¹æ€§é—®é¢˜ï¼Œé…ç½® .npmrc
shamefully-hoist=true    # æå‡ä¾èµ–ï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰
public-hoist-pattern[]=*eslint*  # åªæå‡ç‰¹å®šåŒ…

# 5. æ›´æ–° CI/CD é…ç½®
# .github/workflows/ci.yml
- uses: pnpm/action-setup@v2
  with:
    version: 8
```

### é¢è¯•é¢˜è¯¦è§£

#### 1. ä¸ºä»€ä¹ˆ pnpm æ¯” npm/yarn å¿«ï¼Ÿ

**ç­”æ¡ˆï¼š**

```javascript
// æ ¸å¿ƒåŸå› ï¼šç¡¬é“¾æ¥ + å†…å®¹å¯»å€å­˜å‚¨

// npm/yarn çš„å®‰è£…æµç¨‹ï¼š
1. è§£æä¾èµ–æ ‘
2. ä¸‹è½½æ‰€æœ‰åŒ…åˆ°ç¼“å­˜
3. ä»ç¼“å­˜å¤åˆ¶æ–‡ä»¶åˆ° node_modules  // â±ï¸ æ…¢åœ¨è¿™é‡Œï¼
4. æ‰å¹³åŒ–å¤„ç†

// pnpm çš„å®‰è£…æµç¨‹ï¼š
1. è§£æä¾èµ–æ ‘
2. ä¸‹è½½æ‰€æœ‰åŒ…åˆ°å…¨å±€å­˜å‚¨ï¼ˆ~/.pnpm-storeï¼‰
3. åˆ›å»ºç¡¬é“¾æ¥åˆ° .pnpm/                // âš¡ å¿«ï¼åªæ˜¯é“¾æ¥ï¼Œä¸å¤åˆ¶
4. åˆ›å»ºè½¯é“¾æ¥åˆ° node_modules/         // âš¡ å¿«ï¼

// é€Ÿåº¦ä¼˜åŠ¿ï¼š
- åˆ›å»ºç¡¬é“¾æ¥æ¯”å¤åˆ¶æ–‡ä»¶å¿« 10-100 å€
- ç›¸åŒç‰ˆæœ¬çš„åŒ…åªä¸‹è½½ä¸€æ¬¡ï¼Œæ°¸ä¹…ç¼“å­˜
- å¹¶è¡Œå®‰è£… + COW (Copy-on-Write) ä¼˜åŒ–
```

**å›¾ç¤ºå¯¹æ¯”ï¼š**

```
npm/yarn:
ä¸‹è½½ lodash@4.17.21 (500KB)
  â†“ å¤åˆ¶ 500KB
é¡¹ç›®A/node_modules/lodash
  â†“ å¤åˆ¶ 500KB
é¡¹ç›®B/node_modules/lodash
  â†“ å¤åˆ¶ 500KB
é¡¹ç›®C/node_modules/lodash
æ€»ç£ç›˜å ç”¨ï¼š1.5MB

pnpm:
ä¸‹è½½ lodash@4.17.21 (500KB)
  â†“ å­˜å‚¨åˆ°å…¨å±€
~/.pnpm-store/v3/files/00/abc123
  â†“ ç¡¬é“¾æ¥ï¼ˆ0 å­—èŠ‚ï¼‰
é¡¹ç›®A/.pnpm/lodash@4.17.21
  â†“ ç¡¬é“¾æ¥ï¼ˆ0 å­—èŠ‚ï¼‰
é¡¹ç›®B/.pnpm/lodash@4.17.21
  â†“ ç¡¬é“¾æ¥ï¼ˆ0 å­—èŠ‚ï¼‰
é¡¹ç›®C/.pnpm/lodash@4.17.21
æ€»ç£ç›˜å ç”¨ï¼š500KB
```

#### 2. ä»€ä¹ˆæ˜¯å¹½çµä¾èµ–ï¼Ÿpnpm å¦‚ä½•è§£å†³ï¼Ÿ

**ç­”æ¡ˆï¼š**

```javascript
// å¹½çµä¾èµ–ï¼ˆPhantom Dependenciesï¼‰ï¼š
// èƒ½å¤Ÿ require/import ä¸€ä¸ªæ²¡æœ‰åœ¨ package.json ä¸­å£°æ˜çš„åŒ…

// ä¾‹å­ï¼š
// package.json
{
  "dependencies": {
    "express": "^4.18.0"  // åªå£°æ˜äº† express
  }
}

// npm/yarn æ‰å¹³åŒ–åçš„ node_modulesï¼š
node_modules/
â”œâ”€â”€ express/
â”œâ”€â”€ body-parser/      // express çš„ä¾èµ–ï¼Œè¢«æå‡äº†
â”œâ”€â”€ cookie/           // express çš„ä¾èµ–ï¼Œè¢«æå‡äº†
â””â”€â”€ ...

// ä½ çš„ä»£ç å¯ä»¥ç›´æ¥ç”¨ï¼ˆå¹½çµä¾èµ–ï¼‰ï¼š
import cookie from 'cookie'; // âš ï¸ èƒ½ç”¨ï¼Œä½†å¾ˆå±é™©ï¼

// é—®é¢˜ï¼š
// 1. express@5 å¯èƒ½ç§»é™¤ cookie ä¾èµ–
// 2. ä½ çš„ä»£ç ä¼šçªç„¶å´©æºƒ
// 3. ä¸åŒæœºå™¨ node_modules ç»“æ„å¯èƒ½ä¸åŒï¼ˆå®‰è£…é¡ºåºå½±å“ï¼‰
```

**pnpm çš„è§£å†³æ–¹æ¡ˆï¼š**

```bash
# pnpm çš„ node_modules ç»“æ„ï¼š
node_modules/
â”œâ”€â”€ express -> .pnpm/express@4.18.0/node_modules/express  # è½¯é“¾æ¥
â””â”€â”€ .pnpm/
    â””â”€â”€ express@4.18.0/
        â””â”€â”€ node_modules/
            â”œâ”€â”€ express/          # çœŸå®æ–‡ä»¶
            â”œâ”€â”€ body-parser/      # express çš„ä¾èµ–
            â””â”€â”€ cookie/           # express çš„ä¾èµ–

# ä½ çš„ä»£ç ï¼š
import cookie from 'cookie'; // âŒ æŠ¥é”™ï¼æ‰¾ä¸åˆ°æ¨¡å—

# Node.js æŸ¥æ‰¾æ¨¡å—çš„è·¯å¾„ï¼š
# 1. å½“å‰ç›®å½• node_modules/cookie        â† æ²¡æœ‰
# 2. çˆ¶ç›®å½• node_modules/cookie           â† æ²¡æœ‰
# 3. ... ä¸€ç›´åˆ°æ ¹ç›®å½•                      â† éƒ½æ²¡æœ‰

# è§£å†³ï¼šå¿…é¡»æ˜¾å¼å£°æ˜ä¾èµ–
pnpm add cookie  # åœ¨ package.json ä¸­å£°æ˜
```

**çœŸå®æ¡ˆä¾‹ï¼š**

```javascript
// æŸé¡¹ç›®ä½¿ç”¨äº† @types/nodeï¼Œä½†æ²¡å£°æ˜ä¾èµ–
// npm/yarn èƒ½ç”¨ï¼ˆå› ä¸ºæŸä¸ªä¾èµ–å¼•å…¥äº†å®ƒï¼‰
import { EventEmitter } from 'events'; // âœ… èƒ½ç”¨

// è¿ç§»åˆ° pnpm åæŠ¥é”™
// Error: Cannot find module 'events'

// æ­£ç¡®åšæ³•ï¼šæ˜¾å¼å£°æ˜
pnpm add @types/node

// å¥½å¤„ï¼š
// 1. ä¾èµ–å…³ç³»æ¸…æ™°é€æ˜
// 2. å‡çº§ä¾èµ–ä¸ä¼šç ´åä»£ç 
// 3. å›¢é˜Ÿæˆå‘˜ç¯å¢ƒä¸€è‡´
```

#### 3. pnpm çš„ç¡¬é“¾æ¥æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ

**ç­”æ¡ˆï¼š**

```javascript
// æ–‡ä»¶ç³»ç»ŸåŸºç¡€çŸ¥è¯†ï¼š

// inodeï¼ˆç´¢å¼•èŠ‚ç‚¹ï¼‰ï¼š
// - å­˜å‚¨æ–‡ä»¶çš„å…ƒæ•°æ®ï¼ˆå¤§å°ã€æƒé™ã€æ—¶é—´æˆ³ï¼‰
// - æŒ‡å‘æ–‡ä»¶å®é™…æ•°æ®çš„æŒ‡é’ˆ

// ç¡¬é“¾æ¥ï¼ˆHard Linkï¼‰ï¼š
// - å¤šä¸ªæ–‡ä»¶åæŒ‡å‘åŒä¸€ä¸ª inode
// - å…±äº«åŒä¸€ä»½æ•°æ®
// - åˆ é™¤ä¸€ä¸ªä¸å½±å“å…¶ä»–
// - å¿…é¡»åœ¨åŒä¸€æ–‡ä»¶ç³»ç»Ÿ

// è½¯é“¾æ¥ï¼ˆSymbolic Linkï¼‰ï¼š
// - ç±»ä¼¼ Windows å¿«æ·æ–¹å¼
// - å­˜å‚¨ç›®æ ‡æ–‡ä»¶çš„è·¯å¾„
// - å¯ä»¥è·¨æ–‡ä»¶ç³»ç»Ÿ
```

**pnpm çš„å®ç°ï¼š**

```bash
# å…¨å±€å­˜å‚¨ï¼ˆå†…å®¹å¯»å€ï¼‰
~/.pnpm-store/v3/files/
â””â”€â”€ 00/
    â””â”€â”€ a1b2c3d4e5f6...  # lodash çš„æŸä¸ªæ–‡ä»¶ï¼ˆinode: 12345ï¼‰

# é¡¹ç›® node_modules
é¡¹ç›®/.pnpm/lodash@4.17.21/node_modules/lodash/index.js
# â†‘ ç¡¬é“¾æ¥åˆ°å…¨å±€å­˜å‚¨ï¼ˆinode: 12345ï¼‰

# éªŒè¯æ˜¯å¦æ˜¯ç¡¬é“¾æ¥
ls -li ~/.pnpm-store/v3/files/00/a1b2c3d4e5f6...
# 12345 -rw-r--r-- 3 user group 1024 Jan 1 12:00 a1b2c3d4e5f6...
#  â†‘ inode        â†‘ é“¾æ¥æ•°ï¼ˆ3ä¸ªç¡¬é“¾æ¥ï¼‰

# ç‰¹ç‚¹ï¼š
# 1. ä¿®æ”¹ä»»ä½•ä¸€ä¸ªç¡¬é“¾æ¥ï¼Œæ‰€æœ‰éƒ½ä¼šå˜ï¼ˆåŒä¸€ä»½æ•°æ®ï¼‰
# 2. åˆ é™¤ä¸€ä¸ªç¡¬é“¾æ¥ï¼Œå…¶ä»–ä¸å—å½±å“
# 3. åªæœ‰æ‰€æœ‰ç¡¬é“¾æ¥éƒ½åˆ é™¤ï¼Œæ•°æ®æ‰ä¼šè¢«åˆ é™¤
# 4. ä¸å ç”¨é¢å¤–ç£ç›˜ç©ºé—´
```

**å®Œæ•´ç¤ºä¾‹ï¼š**

```javascript
// 1. å®‰è£…åŒ…
pnpm add lodash

// å†…éƒ¨æµç¨‹ï¼š
// Step 1: ä¸‹è½½åˆ°å…¨å±€å­˜å‚¨
ä¸‹è½½ lodash@4.17.21.tgz
è§£å‹åˆ° ~/.pnpm-store/v3/tmp/
è®¡ç®—æ¯ä¸ªæ–‡ä»¶çš„ hash: sha512(file content)
ç§»åŠ¨åˆ° ~/.pnpm-store/v3/files/{hashå‰2ä½}/{hash}

// Step 2: åˆ›å»ºè™šæ‹Ÿå­˜å‚¨ï¼ˆ.pnpmï¼‰
åˆ›å»ºç›®å½• .pnpm/lodash@4.17.21/node_modules/lodash/
å¯¹æ¯ä¸ªæ–‡ä»¶åˆ›å»ºç¡¬é“¾æ¥:
  .pnpm/lodash@4.17.21/node_modules/lodash/index.js
    â†’ ~/.pnpm-store/v3/files/00/abc123...

// Step 3: åˆ›å»ºè½¯é“¾æ¥
node_modules/lodash
  â†’ .pnpm/lodash@4.17.21/node_modules/lodash

// 2. å†å®‰è£…ä¸€ä¸ªä¾èµ– lodash çš„åŒ…
pnpm add express

// express ä¾èµ– lodash@4.17.21
// åˆ›å»ºç¡¬é“¾æ¥ï¼ˆå¤ç”¨å…¨å±€å­˜å‚¨ï¼‰:
.pnpm/express@4.18.0/node_modules/lodash/index.js
  â†’ ~/.pnpm-store/v3/files/00/abc123...  # åŒä¸€ä¸ª inodeï¼

// ç»“æœï¼š
// - lodash åªä¸‹è½½äº†ä¸€æ¬¡
// - ç£ç›˜åªå ç”¨ä¸€ä»½ç©ºé—´
// - ä¸¤ä¸ªé¡¹ç›®éƒ½èƒ½æ­£å¸¸ä½¿ç”¨
```

**ä¼˜åŠ¿æ€»ç»“ï¼š**

```javascript
// 1. æè‡´çš„ç£ç›˜æ•ˆç‡
// ä¼ ç»Ÿæ–¹å¼ï¼š100ä¸ªé¡¹ç›® Ã— 200MB = 20GB
// pnpm:     å…¨å±€å­˜å‚¨ 2GB + ç¡¬é“¾æ¥å¼€é”€ < 3GB

// 2. å®‰è£…é€Ÿåº¦å¿«
// å¤åˆ¶æ–‡ä»¶ï¼šO(n) æ—¶é—´å¤æ‚åº¦ï¼Œå–å†³äºæ–‡ä»¶å¤§å°
// ç¡¬é“¾æ¥ï¼š  O(1) æ—¶é—´å¤æ‚åº¦ï¼Œåªåˆ›å»ºç´¢å¼•

// 3. ç¼“å­˜æ°¸ä¹…æœ‰æ•ˆ
// npm/yarn: æ¯ä¸ªé¡¹ç›®éƒ½è¦ä»ç¼“å­˜å¤åˆ¶åˆ° node_modules
// pnpm:     å®‰è£…è¿‡çš„åŒ…ï¼Œæ‰€æœ‰é¡¹ç›®ç›´æ¥ç¡¬é“¾æ¥ï¼Œç§’è£…

// 4. ä¾èµ–ä¸¥æ ¼éš”ç¦»
// npm/yarn: æ‰å¹³åŒ–ï¼Œæœ‰å¹½çµä¾èµ–é£é™©
// pnpm:     è½¯é“¾æ¥ + ç¡¬é“¾æ¥ï¼Œæ¯ä¸ªåŒ…åªèƒ½è®¿é—®å£°æ˜çš„ä¾èµ–
```

## å­¦ä¹ è·¯çº¿

1. **Webpack** - æœ€æµè¡Œçš„æ‰“åŒ…å·¥å…·
2. **Vite** - æ–°ä¸€ä»£æ„å»ºå·¥å…·
3. **Babel** - JavaScriptç¼–è¯‘å™¨
4. **ä»£ç è§„èŒƒ** - ä¿è¯ä»£ç è´¨é‡
5. **CI/CD** - è‡ªåŠ¨åŒ–éƒ¨ç½²
6. **Monorepo** - å¤§å‹é¡¹ç›®ç®¡ç†

---

å¼€å§‹å­¦ä¹ å…·ä½“å†…å®¹ ğŸ‘‰
